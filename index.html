// í†µí•© ê²°ê³¼ë¥¼ í˜„ì¬ ë¶„ì„ ìƒíƒœì— ì ìš© (ìˆ˜ì •)
function applyIntegratedResult(data) {
    // ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
    basket = data.basket;
    survivors = data.survivors;
    compressedOut4 = data.compressedOut;
    full14 = data.full14;
    replacedIn = data.replacedIn;
    replacedOut = data.replacedOut;
    middle = data.middleBag;
    weightedScore = data.weightedScore;

    isIntegratedState = true; // í†µí•© ìƒíƒœ í”Œë˜ê·¸ ì„¤ì •

    // UI ì—…ë°ì´íŠ¸
    const targetRound = currentBaseRound;
    const prevRound = targetRound - 1;
    const prevData = FULL_DATA.find(row => row[0] === prevRound);
    if (prevData) {
        const baseNums = prevData.slice(1, 7);
        const bonus = prevData[7];
        let ballHtml = baseNums.map(n => `<span class="base-num-box">${n}</span>`).join('');
        ballHtml += `<span class="bonus-label">ë³´ë„ˆìŠ¤</span>`;
        ballHtml += `<span class="base-num-box">${bonus}</span>`;
        document.getElementById('baseRoundInfo').innerHTML = ballHtml;
    }

    let replacedInHtml = replacedIn.length ? replacedIn.map(n => `<span class="replaced-in">${n}</span>`).join(', ') : 'ì—†ìŒ';
    let replacedOutHtml = replacedOut.length ? replacedOut.map(n => `<span class="replaced-out">${n}</span>`).join(', ') : 'ì—†ìŒ';
    let compressedOutHtml = compressedOut4.map(n => 
        replacedIn.includes(n) ? `<span class="replaced-in">${n}</span>` : n
    ).join(', ');

    document.getElementById('status').innerHTML = `
        <div><span class="highlight-gold">â˜… [í†µí•© ì ìš©] ì••ì¶•ìˆ˜ ${currentCompress}</span></div>
        <div>ìƒì¡´ì ${survivors.length}ìˆ˜: ${survivors.join(', ')}</div>
        <div>AI ì¶”ì²œ ${basket.length}ìˆ˜: ${basket.join(', ')}</div>
        <div>ğŸ”» 14ìˆ˜ì—ì„œ ë¹ ì§„ ${compressedOut4.length}ê°œ (êµì²´ í›„ ë‚¨ì€): ${compressedOutHtml}</div>
        <div style="margin-top:4px;">
            <span style="color:#ff6666;">â–¶ êµì²´ëœ ë²ˆí˜¸: ${replacedInHtml}</span><br>
            <span style="color:#66aaff;">â—€ êµì²´ë‹¹í•œ ë²ˆí˜¸: ${replacedOutHtml}</span><br>
            <span style="color:#aaa;">ğŸ“¦ B bag: ${middle.join(', ') || 'ì—†ìŒ'}</span>
        </div>
        <div><span class="highlight-blue">ğŸ“Š (í†µí•© ë¶„ì„ ê²°ê³¼ ì ìš©ë¨)</span></div>
    `;

    const reviewAIInfo = document.getElementById('reviewAIInfo');
    if (reviewAIInfo) {
        reviewAIInfo.innerHTML = `
            <div><span class="highlight-blue">ìƒì¡´ì ${survivors.length}ìˆ˜:</span> ${survivors.join(', ')}</div>
            <div><span class="highlight-gold">AI ì¶”ì²œ ${basket.length}ìˆ˜:</span> ${basket.join(', ')}</div>
            <div><span class="highlight-blue">ğŸ”» 14ìˆ˜ì—ì„œ ë¹ ì§„ ${compressedOut4.length}ê°œ (êµì²´ í›„ ë‚¨ì€):</span> ${compressedOutHtml}</div>
            <div><span style="color:#ff6666;">â–¶ êµì²´ëœ ë²ˆí˜¸: ${replacedInHtml}</span></div>
            <div><span style="color:#66aaff;">â—€ êµì²´ë‹¹í•œ ë²ˆí˜¸: ${replacedOutHtml}</span></div>
            <div><span style="color:#aaa;">ğŸ“¦ B bag: ${middle.join(', ') || 'ì—†ìŒ'}</span></div>
        `;
    }

    // íŒì—… ë‹«ê¸°
    const popup = document.querySelector('.popup-overlay');
    if (popup) popup.remove();
    
    showToast('í†µí•© ë¶„ì„ ê²°ê³¼ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. 5/10ì¡°í•©ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
    
    // ë””ë²„ê¹…: ì ìš©ëœ ê°’ í™•ì¸ (ì„ íƒì‚¬í•­)
    console.log('ì ìš©ëœ basket:', basket);
    console.log('ì ìš©ëœ compressedOut4:', compressedOut4);
}
